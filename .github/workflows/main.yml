name: Notify Lark on Iconfont Changes

on:
  push:
    branches:
      - main
    paths:
      - "src/action/iconfont*"

jobs:
  notify-lark:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get changed iconfont files
        id: changes
        run: |
          git fetch --depth=2
          git diff --name-only ${{ github.event.before }} ${{ github.sha }} > changed.txt
          ICONFONT_CHANGED=$(grep '^src/action/iconfont' changed.txt || true)
          echo "CHANGED_FILES=$ICONFONT_CHANGED" >> $GITHUB_ENV

      - name: Send notification to Lark
        if: env.CHANGED_FILES != ''
        run: |
          curl -X POST "$LARK_WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d '{
              "msg_type": "text",
              "content": {
                "text": "ğŸ¯ iconfont ç›®å½•æœ‰å˜æ›´\nåˆ†æ”¯ï¼š${{ github.ref_name }}\næäº¤äººï¼š${{ github.actor }}\næäº¤ä¿¡æ¯ï¼š${{ github.event.head_commit.message }}"
              }
            }'
        env:
          LARK_WEBHOOK_URL: ${{ secrets.LARK_WEBHOOK_URL }}
