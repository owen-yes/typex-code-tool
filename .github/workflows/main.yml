name: Notify Lark on Iconfont Changes

on:
  push:
    branches:
      - main
    paths:
      - 'src/action/iconfont*'  # ç›‘å¬ç‰¹å®šè·¯å¾„ä¸‹çš„æ”¹åŠ¨

jobs:
  notify-lark:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get changed iconfont files
        id: changes
        run: |
          git fetch origin main
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | grep '^src/action/iconfont' || true)
          echo "CHANGED_FILES=$CHANGED_FILES" >> $GITHUB_ENV

      - name: Send notification to Lark
        if: env.CHANGED_FILES != ''
        run: |
          curl -X POST "$LARK_WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d '{
              "msg_type": "text",
              "content": {
                "text": "ğŸ› ï¸  Iconfont æ–‡ä»¶å‘ç”Ÿå˜æ›´\nåˆ†æ”¯ï¼š${{ github.ref_name }}\næäº¤äººï¼š${{ github.actor }}\næäº¤ä¿¡æ¯ï¼š${{ github.event.head_commit.message }}"
              }
            }'
        env:
          LARK_WEBHOOK_URL: ${{ secrets.LARK_WEBHOOK_URL }}
